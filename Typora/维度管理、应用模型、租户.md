# 维度管理

## 维度相关的获取

```java
1.通过维度结构取 member 和 levelvalue
	IDimManager mgr = DimServiceGetter.getDimManager();
	DimHierarchy dhcust = mgr.getDimHierarchyByPK(dimhieraryPK);--- 获取维度结构
	List<DimMember> members = dhcust.getMemberReader().getMembers(); --- 获取该维度结构下的维度成员
	Map<String,String> map=new HashMap<>();
	//除"外系统客商"外
	for(DimMember dm:members){
		String levelValue = dm.getLevelValue().getTreeKey();
	}
	//外部系统客商--被投资方
	for(DimMember dm:members){
		map.put(dm.getLevelValue().getTreeKey(),(String)dm.getLevelValue().getPkCustInnerOrg());---获取外系统客商和内部单位的对应关系
	}
	
2.获取应用模型下维度结构
	ICubeBuildResultService cubeBuildResultService = ServiceLocator.find(ICubeBuildResultService.class);
	DimHierarchy dh = cubeBuildResultService.queryDimHierByPkDimDef(pk_cube, IDimDefPKConst.BM_CUST---维度结构的PK, CubeDimUsage.dimhier_type_member---成员视图);
	
	第二种法子
	CubeDef cube = ?;
	cube.getDimHierarchy(dimhierPk);
	
	
3.根据应用模型的PK获取应用模型的定义
	ICubeDefQueryService service = NCLocator.getInstance().lookup(ICubeDefQueryService.class);
	CubeDef cube = null;
	try {
		cube = service.queryCubeDefByPK(pk_cube);
	} catch (BusinessException e) {
		NtbLogger.error(e);
	}
4.结构视图 转 成员视图
	DimManagerUtil.getMemberLevelValueFromStrLevelValue()
```



# 应用模型

## 概念

```
’多维’应用模型：
1 用户分析问题的角度，比如在分析销售量的时候，可以从商品的种类，时间，地区等等几个角度进行分析，此时该产品的种类，时间，地区就是维。---结合多个维度，从多方面描述一个问题或者节点
2 在多维应用模型中，每一个维都取一个维度成员，就会得到一组唯一确定维度变量值，也就是事实。比如，2000年，北京，产品A的销售量为5683，这就是一个事实。多维应用模型的立方体，就是维度和事实的组合表示。
3 维度--将数据进行细分
4 维度表：记录维信息维度表，事实表：由事实的名称和度量，及每个相关维度表的码组成，
5 常见的多维应用模型-星形模型和雪花模型
6 在多维应用模型中，每一个维度表必须确定好结构，----在nc库中的表现就是在应用模型tb_cube_poc中有着每一个维度下的确定的维度结构下的维度层次的字段----根据层次可以确定结构
7 切片的理解-当我们用多个维度描述一个问题是，拿掉其中的一个维度，这是切片
比如 2020年，A公司，卖手机赚了10000块
			           卖电脑赚了2000块
			           卖手环赚了3000块                        此时拿掉电子产品这个维度，描述就会变成
2020年，A公司，赚了15000块
```

![](C:\Users\Administrator\Desktop\葵花宝典\表情包\星型模型.png)

![](C:\Users\Administrator\Desktop\葵花宝典\表情包\雪花模型.png)

## 数据库

tb_cubedef - 应用模型定义表

tb_cube_innercode --- 应用模型的数据表





# 租户

## 租户相关信息的获取

```
1.获取租户id
  String userId = NCCLoudSession.getInstance().getClientInfo().getUserid();
  String tenantId = NCCLoudSession.getInstance().getClientInfo().getTenantid();
  String yht_access_token = null;
  if(NCCLoudSession.getInstance().getCookieValue("yht_access_token")!=null) {
   yht_access_token = new String(NCCLoudSession.getInstance().getCookieValue("yht_access_token"));
  }
2.根据租户分表
  a	通过Vo
  TbDynamicTableMappingMeta meta = DynamicTableFactory.getTbDynamicTableMappingMetaByTenant(new VO());
  b 通过表名
  String newTableName = DynamicTableFactory.getDynamicTableNameByTenant("tableName");
  c VO应该满足的条件
  
	implements IDynamicSuperVO 
	
	private final static String[] colArray = new String[] {
			列
	};
	
	private String tableName = "";
	public void setTableName(String tableName) {
		this.tableName = tableName;
	}

    @Override
	public String[] getColNames() {
		return colArray;
	}

    private final static String[] colArray = new String[] {

	};
3.后台获取租户ID
	//外系统信息表按登录租户过滤
	String tenantId = NCCLoudSession.getInstance().getClientInfo().getTenantid();
	//测试
	if(tenantId==null) {
		tenantId = "pnhodtfi";
	}
	//		InvocationInfoProxy.getInstance().getGroupId()
	

```

